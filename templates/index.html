<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDispatcher - Premium GTA V Mods</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0066ff;
            --primary-blue-dark: #0052cc;
            --bg-dark: #0c0c14;
            --bg-card: #12121c;
            --bg-card-hover: #1a1a28;
            --text-primary: #ffffff;
            --text-secondary: #6b7280;
            --border-color: #1e1e2e;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg-dark); color: var(--text-primary); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; min-height: 100vh; }

        .navbar { background: rgba(12, 12, 20, 0.95); backdrop-filter: blur(10px); padding: 1rem 0; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .navbar-brand { display: flex; align-items: center; gap: 0.5rem; font-size: 1.25rem; font-weight: 700; text-decoration: none; }
        .nav-link { color: var(--text-secondary) !important; font-weight: 500; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px; transition: color 0.3s ease; margin: 0 0.5rem; text-decoration: none; cursor: pointer; }
        .nav-link:hover, .nav-link.active { color: var(--primary-blue) !important; }

        .user-icon { width: 36px; height: 36px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); cursor: pointer; }

        .hero-section { padding: 12rem 0 6rem; position: relative; min-height: 600px; text-align: center; }
        .hero-title { font-size: 5rem; font-weight: 800; line-height: 1.1; margin-bottom: 1.5rem; text-transform: uppercase; }
        .hero-subtitle { color: var(--text-secondary); font-size: 1.5rem; max-width: 700px; margin: 0 auto 2rem; line-height: 1.6; }

        .btn-primary-custom { background: var(--primary-blue); border: none; padding: 0.875rem 1.75rem; font-weight: 600; border-radius: 6px; color: white; transition: all 0.3s ease; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none; }
        .btn-primary-custom:hover { background: var(--primary-blue-dark); transform: translateY(-2px); }

        .app-section { display: none; padding-top: 8rem; }
        .app-section.active { display: block; }

        .card { background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 2rem; }
        .stat-card { text-align: center; }
        .stat-number { font-size: 2.5rem; font-weight: 700; margin: 0.5rem 0; }
        .stat-number.blue { color: var(--primary-blue); }

        .product-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; transition: all 0.3s ease; height: 100%; cursor: pointer; }
        .product-card:hover { border-color: var(--primary-blue); transform: translateY(-4px); }
        .product-image { height: 180px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; align-items: center; justify-content: center; position: relative; }
        .product-body { padding: 1.5rem; }

        .firewall-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: #ff4444; }
    </style>
</head>
<body>
    <div id="firewall" class="firewall-overlay">
        <i class="bi bi-shield-lock-fill display-1 mb-4"></i>
        <h1>ACCESS BLOCKED</h1>
        <button class="btn btn-primary-custom mt-4" onclick="location.reload()">Reset</button>
    </div>

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" onclick="showSection('home')" style="cursor: pointer;">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="LOGO" style="height: 40px; margin-right: 10px;">
                <span style="color: #0066ff;">MY</span><span style="color: #ffffff;">DISPATCHER</span>
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" onclick="showSection('home')">Home</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('browse')">Shop</a></li>
                    {% if current_user.is_authenticated and current_user.is_admin %}
                    <li class="nav-item"><a class="nav-link" onclick="showSection('admin')">Admin</a></li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav">
                    {% if current_user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link" onclick="showSection('upload')">Upload</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('settings')"><i class="bi bi-gear"></i> Settings</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="logout()">Logout</a></li>
                    {% else %}
                    <li class="nav-item"><a class="btn btn-outline-light me-2" href="{{ url_for('login') }}">Login</a></li>
                    <li class="nav-item"><a class="btn btn-primary-custom" href="{{ url_for('register') }}">Register</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- HOME SECTION -->
    <section id="home" class="app-section active">
        <div class="hero-section" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ url_for('static', filename='banner.webp') }}'); background-size: cover;">
            <div class="container">
                <h1 class="hero-title"><span style="color: #0066ff;">MY</span><span style="color: #ffffff;">DISPATCHER</span></h1>
                <p class="hero-subtitle">The ultimate source for high-quality GTA V resources.</p>
                <button onclick="showSection('browse')" class="btn btn-primary-custom btn-lg">Browse Shop</button>
            </div>
        </div>
        <div class="container mt-5">
            <div class="row g-4 text-center">
                <div class="col-md-4"><div class="card"><div class="stat-number blue" id="stat-mods">0</div><div>Total Mods</div></div></div>
                <div class="col-md-4"><div class="card"><div class="stat-number blue" id="stat-users">{{ total_users }}</div><div>Active Users</div></div></div>
                <div class="col-md-4"><div class="card"><div class="stat-number blue" id="stat-downloads">0</div><div>Total Downloads</div></div></div>
            </div>
            <h2 class="mt-5 mb-4">Featured Resources</h2>
            <div class="row g-4" id="featured-mods"></div>
        </div>
    </section>

    <!-- BROWSE SECTION -->
    <section id="browse" class="app-section">
        <div class="container">
            <h1 class="mb-4">Browse Mods</h1>
            <input type="text" id="search-input" class="form-control mb-4" placeholder="Search mods..." onkeyup="renderBrowse()">
            <div class="row g-4" id="browse-list"></div>
        </div>
    </section>

    <!-- ADMIN SECTION -->
    <section id="admin" class="app-section">
        <div class="container">
            <h1 class="mb-4">Admin Dashboard</h1>
            <div class="row g-4">
                <div class="col-md-3"><button class="btn btn-primary-custom w-100 p-4" onclick="showSection('upload')">Publish New Mod</button></div>
                <div class="col-md-3"><div class="card text-center"><h3>Mods</h3><div class="stat-number blue" id="admin-mods">0</div></div></div>
            </div>
            <div class="mt-5"><h3>Manage Mods</h3><div id="admin-mod-list"></div></div>
        </div>
    </section>

    <!-- SETTINGS SECTION -->
    <section id="settings" class="app-section">
        <div class="container">
            <div class="card mx-auto" style="max-width: 600px;">
                <h2 class="mb-4">Settings</h2>
                <form onsubmit="handleSettings(event)">
                    <input type="text" id="set-user" class="form-control mb-3" placeholder="Username">
                    <button type="submit" class="btn btn-primary-custom w-100">Save Changes</button>
                </form>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const db = {
            get: (key) => JSON.parse(localStorage.getItem('md_' + key)) || [],
            set: (key, val) => localStorage.setItem('md_' + key, JSON.stringify(val)),
            init: () => {
                if (!db.get('mods').length) {
                    db.set('mods', [
                        { id: 1, title: 'Dispatch Audio', desc: 'Realistic police radio chatter.', version: '1.0', downloads: 540, category: 'scripts' },
                        { id: 2, title: 'SAHP EUP', desc: 'Complete uniform pack for SAHP.', version: '2.0', downloads: 320, category: 'eup' }
                    ]);
                }
            }
        };

        function showSection(id) {
            document.querySelectorAll('.app-section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (id === 'home') renderHome();
            if (id === 'browse') renderBrowse();
            if (id === 'admin') renderAdmin();
            window.scrollTo(0, 0);
        }

        function logout() { window.location.href = "{{ url_for('logout') }}"; }

        function renderHome() {
            const mods = db.get('mods');
            document.getElementById('stat-mods').textContent = mods.length;
            document.getElementById('featured-mods').innerHTML = mods.slice(0, 3).map(m => `
                <div class="col-md-4">
                    <div class="product-card">
                        <div class="product-image"><h3>${m.title}</h3></div>
                        <div class="product-body"><h5>${m.title}</h5><p>${m.desc}</p></div>
                    </div>
                </div>
            `).join('');
        }

        function renderBrowse() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const mods = db.get('mods').filter(m => m.title.toLowerCase().includes(q));
            document.getElementById('browse-list').innerHTML = mods.map(m => `
                <div class="col-md-4">
                    <div class="product-card">
                        <div class="product-image"><h3>${m.title}</h3></div>
                        <div class="product-body"><h5>${m.title}</h5><p>${m.desc}</p></div>
                    </div>
                </div>
            `).join('');
        }

        function renderAdmin() {
            const mods = db.get('mods');
            document.getElementById('admin-mods').textContent = mods.length;
            document.getElementById('admin-mod-list').innerHTML = mods.map(m => `
                <div class="card mb-3 d-flex flex-row justify-content-between">
                    <span>${m.title}</span><button class="btn btn-danger btn-sm" onclick="deleteMod(${m.id})">Delete</button>
                </div>
            `).join('');
        }

        function deleteMod(id) {
            const mods = db.get('mods').filter(m => m.id !== id);
            db.set('mods', mods);
            renderAdmin();
        }

        db.init();
        showSection('home');
    </script>
</body>
</html>
